# Local development stack.
# Runs the web app with a Mailpit SMTP catcher for local email testing.
#
# Usage:
#   docker compose up
#
# Web app:  http://localhost:8080
# Mailpit:  http://localhost:8025

services:
  web-app:
    build:
      context: ..
      dockerfile: web-app/Dockerfile
    ports:
      - "8080:8080"
    environment:
      BASE_URL: http://localhost:8080
      DATABASE_DRIVER: sqlite
      DATABASE_URL: /data/app.db
      EMAIL_DRIVER: smtp
      SMTP_HOST: mailpit
      SMTP_PORT: 1025
      SMTP_FROM: tyler@localhost
      # ADMIN_EMAILS: you@example.com
      # MAGIC_LINK_SECRET: <generate with: openssl rand -base64 32>
    volumes:
      - web-app-data:/data
    depends_on:
      - mailpit

  mailpit:
    image: axllent/mailpit:latest
    ports:
      - "8025:8025"  # Web UI
      - "1025:1025"  # SMTP

volumes:
  web-app-data:
